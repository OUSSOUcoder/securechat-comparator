<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur Perfect Forward Secrecy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .message-appear {
            animation: slideIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        let mode = 'sans-pfs'; // 'sans-pfs' ou 'avec-pfs'
        let messages = [];
        let masterKey = '';
        let isCompromised = false;
        let currentStep = 'messaging'; // 'messaging', 'compromised', 'result'

        function generateKey() {
            return 'KEY_' + Math.random().toString(36).substring(2, 8).toUpperCase();
        }

        function initMode(newMode) {
            mode = newMode;
            messages = [];
            isCompromised = false;
            currentStep = 'messaging';
            if (mode === 'sans-pfs') {
                masterKey = generateKey();
            }
            render();
        }

        function sendMessage() {
            const msgKey = mode === 'avec-pfs' ? generateKey() : masterKey;
            const msgNum = messages.length + 1;
            
            messages.push({
                id: msgNum,
                text: `Message ${msgNum}`,
                key: msgKey,
                timestamp: new Date().toLocaleTimeString('fr-FR'),
                compromised: false
            });
            
            render();
        }

        function compromiseKeys() {
            isCompromised = true;
            currentStep = 'compromised';
            
            if (mode === 'sans-pfs') {
                // Tous les messages sont compromis
                messages.forEach(msg => msg.compromised = true);
            } else {
                // Seulement les futurs messages (simulation)
                // Les anciens restent prot√©g√©s
            }
            
            render();
        }

        function showResult() {
            currentStep = 'result';
            render();
        }

        function reset() {
            initMode(mode);
        }

        function render() {
            const app = document.getElementById('app');
            
            app.innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 p-8">
                    <div class="max-w-6xl mx-auto">
                        <!-- Header -->
                        <div class="text-center mb-8">
                            <h1 class="text-5xl font-bold text-white mb-2 flex items-center justify-center gap-3">
                                üîê Perfect Forward Secrecy (PFS)
                            </h1>
                            <p class="text-xl text-gray-300">
                                Prot√©gez votre historique contre les compromissions futures
                            </p>
                        </div>

                        ${currentStep === 'messaging' && !mode ? `
                            <!-- Mode Selection -->
                            <div class="grid grid-cols-2 gap-8 max-w-4xl mx-auto">
                                <button onclick="initMode('sans-pfs')" class="bg-red-500/20 backdrop-blur-lg rounded-2xl p-8 border-2 border-red-500 hover:border-red-400 transition-all hover:scale-105">
                                    <div class="text-6xl mb-4">‚ùå</div>
                                    <h2 class="text-3xl font-bold text-white mb-4">SANS PFS</h2>
                                    <p class="text-gray-200 mb-4">
                                        Une seule cl√© ma√Ætre pour tous les messages
                                    </p>
                                    <div class="bg-red-500/30 rounded-lg p-4 text-sm text-gray-200">
                                        ‚ö†Ô∏è Si cette cl√© est compromise dans le futur, 
                                        <strong>tout l'historique est expos√©</strong>
                                    </div>
                                </button>

                                <button onclick="initMode('avec-pfs')" class="bg-green-500/20 backdrop-blur-lg rounded-2xl p-8 border-2 border-green-500 hover:border-green-400 transition-all hover:scale-105">
                                    <div class="text-6xl mb-4">‚úÖ</div>
                                    <h2 class="text-3xl font-bold text-white mb-4">AVEC PFS</h2>
                                    <p class="text-gray-200 mb-4">
                                        Cl√© √©ph√©m√®re unique pour chaque message
                                    </p>
                                    <div class="bg-green-500/30 rounded-lg p-4 text-sm text-gray-200">
                                        ‚úì Compromission future ne r√©v√®le pas l'historique.
                                        <strong>Protection du pass√© garantie</strong>
                                    </div>
                                </button>
                            </div>
                        ` : ''}

                        ${mode && currentStep === 'messaging' ? `
                            <div class="space-y-6">
                                <!-- Mode Info -->
                                <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border ${
                                    mode === 'sans-pfs' ? 'border-red-500' : 'border-green-500'
                                }">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <h2 class="text-2xl font-bold text-white mb-2">
                                                Mode: ${mode === 'sans-pfs' ? '‚ùå SANS PFS' : '‚úÖ AVEC PFS'}
                                            </h2>
                                            <p class="text-gray-300">
                                                ${mode === 'sans-pfs' 
                                                    ? `Cl√© Ma√Ætre: <span class="font-mono text-yellow-300">${masterKey}</span>` 
                                                    : 'Nouvelle cl√© √©ph√©m√®re pour chaque message'}
                                            </p>
                                        </div>
                                        <button onclick="initMode(null)" class="px-6 py-3 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-lg transition-all">
                                            Changer de Mode
                                        </button>
                                    </div>
                                </div>

                                <!-- Actions -->
                                <div class="grid grid-cols-2 gap-4">
                                    <button onclick="sendMessage()" class="px-8 py-6 bg-blue-600 hover:bg-blue-700 text-white font-bold text-xl rounded-xl transition-all flex items-center justify-center gap-3">
                                        üì§ Envoyer un Message (${messages.length})
                                    </button>
                                    <button onclick="compromiseKeys()" ${messages.length < 3 ? 'disabled' : ''} class="px-8 py-6 bg-red-600 hover:bg-red-700 disabled:bg-gray-500 text-white font-bold text-xl rounded-xl transition-all flex items-center justify-center gap-3">
                                        üí• Compromettre les Cl√©s
                                    </button>
                                </div>

                                ${messages.length < 3 ? `
                                    <div class="bg-yellow-500/20 border border-yellow-500/50 rounded-xl p-4 text-center">
                                        <p class="text-yellow-300">
                                            üìù Envoyez au moins 3 messages avant de simuler une compromission
                                        </p>
                                    </div>
                                ` : ''}

                                <!-- Messages Timeline -->
                                <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                                    <h3 class="text-2xl font-bold text-white mb-4">üì® Historique des Messages</h3>
                                    <div class="space-y-3 max-h-96 overflow-y-auto">
                                        ${messages.length === 0 ? `
                                            <div class="text-center py-12 text-gray-400">
                                                Aucun message envoy√©. Cliquez sur "Envoyer un Message"
                                            </div>
                                        ` : messages.map(msg => `
                                            <div class="message-appear p-4 rounded-lg ${
                                                mode === 'sans-pfs' ? 'bg-red-500/20 border-2 border-red-500/50' : 'bg-green-500/20 border-2 border-green-500/50'
                                            }">
                                                <div class="flex items-start justify-between">
                                                    <div class="flex-1">
                                                        <div class="flex items-center gap-3 mb-2">
                                                            <span class="text-2xl">üí¨</span>
                                                            <div>
                                                                <div class="text-white font-bold">${msg.text}</div>
                                                                <div class="text-xs text-gray-400">${msg.timestamp}</div>
                                                            </div>
                                                        </div>
                                                        <div class="bg-black/30 rounded-lg p-3 mt-2">
                                                            <p class="text-xs text-gray-300 mb-1">Cl√© de chiffrement:</p>
                                                            <p class="font-mono text-sm ${mode === 'sans-pfs' ? 'text-yellow-300' : 'text-green-300'}">
                                                                üîë ${msg.key}
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <div class="px-3 py-1 rounded-full text-xs font-bold ${
                                                        mode === 'sans-pfs' ? 'bg-yellow-500/30 text-yellow-300' : 'bg-green-500/30 text-green-300'
                                                    }">
                                                        ${mode === 'sans-pfs' ? 'CL√â MA√éTRE' : 'CL√â √âPH√âM√àRE'}
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        ` : ''}

                        ${currentStep === 'compromised' ? `
                            <div class="space-y-6">
                                <!-- Compromission Alert -->
                                <div class="bg-red-500/30 backdrop-blur-lg rounded-2xl p-8 border-4 border-red-500 animate-pulse">
                                    <div class="text-center mb-6">
                                        <div class="text-8xl mb-4">üö®</div>
                                        <h2 class="text-4xl font-bold text-red-300 mb-2">
                                            COMPROMISSION D√âTECT√âE !
                                        </h2>
                                        <p class="text-xl text-gray-200">
                                            Un attaquant a obtenu ${mode === 'sans-pfs' ? 'la cl√© ma√Ætre' : 'les cl√©s actuelles'}
                                        </p>
                                    </div>

                                    ${mode === 'sans-pfs' ? `
                                        <div class="bg-black/40 rounded-xl p-6 mb-4">
                                            <p class="text-red-300 font-bold text-lg mb-2">
                                                ‚ùå Cl√© Ma√Ætre Compromise:
                                            </p>
                                            <p class="font-mono text-2xl text-yellow-300">${masterKey}</p>
                                        </div>
                                        <div class="bg-red-600/50 rounded-xl p-4">
                                            <p class="text-white text-center text-lg">
                                                ‚ö†Ô∏è <strong>TOUS</strong> les ${messages.length} messages de l'historique peuvent maintenant √™tre d√©chiffr√©s !
                                            </p>
                                        </div>
                                    ` : `
                                        <div class="bg-green-600/30 rounded-xl p-6">
                                            <p class="text-white text-center text-lg mb-4">
                                                ‚úÖ Les ${messages.length} messages pass√©s restent <strong>PROT√âG√âS</strong>
                                            </p>
                                            <p class="text-gray-200 text-sm text-center">
                                                Les cl√©s √©ph√©m√®res ont √©t√© d√©truites apr√®s chiffrement.
                                                L'attaquant ne peut pas remonter dans le temps !
                                            </p>
                                        </div>
                                    `}
                                </div>

                                <!-- Messages Status -->
                                <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                                    <h3 class="text-2xl font-bold text-white mb-4">√âtat des Messages</h3>
                                    <div class="space-y-3 max-h-96 overflow-y-auto">
                                        ${messages.map(msg => `
                                            <div class="p-4 rounded-lg border-2 ${
                                                mode === 'sans-pfs' 
                                                    ? 'bg-red-500/30 border-red-500' 
                                                    : 'bg-green-500/30 border-green-500'
                                            }">
                                                <div class="flex items-center justify-between">
                                                    <div class="flex items-center gap-3">
                                                        <span class="text-2xl">${mode === 'sans-pfs' ? 'üîì' : 'üîí'}</span>
                                                        <div>
                                                            <div class="text-white font-bold">${msg.text}</div>
                                                            <div class="text-xs font-mono text-gray-300">${msg.key}</div>
                                                        </div>
                                                    </div>
                                                    <div class="px-4 py-2 rounded-lg font-bold ${
                                                        mode === 'sans-pfs' 
                                                            ? 'bg-red-600 text-white' 
                                                            : 'bg-green-600 text-white'
                                                    }">
                                                        ${mode === 'sans-pfs' ? '‚ùå EXPOS√â' : '‚úÖ PROT√âG√â'}
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>

                                <button onclick="showResult()" class="w-full px-8 py-6 bg-blue-600 hover:bg-blue-700 text-white font-bold text-xl rounded-xl transition-all">
                                    üìä Voir l'Analyse Compl√®te
                                </button>
                            </div>
                        ` : ''}

                        ${currentStep === 'result' ? `
                            <div class="space-y-6">
                                <!-- Summary -->
                                <div class="bg-white/10 backdrop-blur-lg rounded-2xl p-8 border-2 ${
                                    mode === 'sans-pfs' ? 'border-red-500' : 'border-green-500'
                                }">
                                    <h2 class="text-3xl font-bold text-white mb-6 text-center">
                                        üìä R√©sultat de la Simulation
                                    </h2>
                                    
                                    <div class="grid grid-cols-2 gap-6 mb-6">
                                        <div class="bg-white/5 rounded-xl p-6 text-center">
                                            <div class="text-5xl font-bold ${mode === 'sans-pfs' ? 'text-red-400' : 'text-green-400'} mb-2">
                                                ${mode === 'sans-pfs' ? messages.length : '0'}
                                            </div>
                                            <div class="text-gray-300">Messages Compromis</div>
                                        </div>
                                        <div class="bg-white/5 rounded-xl p-6 text-center">
                                            <div class="text-5xl font-bold ${mode === 'sans-pfs' ? 'text-yellow-400' : 'text-green-400'} mb-2">
                                                ${mode === 'sans-pfs' ? '0' : messages.length}
                                            </div>
                                            <div class="text-gray-300">Messages Prot√©g√©s</div>
                                        </div>
                                    </div>

                                    <div class="bg-${mode === 'sans-pfs' ? 'red' : 'green'}-500/20 rounded-xl p-6 border-2 border-${mode === 'sans-pfs' ? 'red' : 'green'}-500">
                                        ${mode === 'sans-pfs' ? `
                                            <h3 class="text-red-300 font-bold text-xl mb-4">‚ùå SANS PFS - Vuln√©rabilit√© Critique</h3>
                                            <ul class="space-y-2 text-white">
                                                <li>‚úó Une seule cl√© pour ${messages.length} messages</li>
                                                <li>‚úó Compromission future = tout l'historique expos√©</li>
                                                <li>‚úó Pas de protection du pass√©</li>
                                                <li>‚úó Risque maximal pour donn√©es sensibles</li>
                                            </ul>
                                        ` : `
                                            <h3 class="text-green-300 font-bold text-xl mb-4">‚úÖ AVEC PFS - Protection Maximale</h3>
                                            <ul class="space-y-2 text-white">
                                                <li>‚úì Cl√© unique par message (${messages.length} cl√©s diff√©rentes)</li>
                                                <li>‚úì Cl√©s d√©truites apr√®s usage</li>
                                                <li>‚úì Compromission future ne r√©v√®le pas le pass√©</li>
                                                <li>‚úì <strong>Perfect Forward Secrecy</strong> garantie</li>
                                            </ul>
                                        `}
                                    </div>
                                </div>

                                <!-- Comparison -->
                                <div class="bg-blue-500/20 border border-blue-500/50 rounded-xl p-6">
                                    <h3 class="text-blue-300 font-bold text-xl mb-4">üí° Applications R√©elles</h3>
                                    <div class="grid grid-cols-3 gap-4 text-sm">
                                        <div class="bg-green-500/20 rounded-lg p-4 border border-green-500/50">
                                            <div class="text-2xl mb-2">‚úÖ</div>
                                            <div class="text-white font-bold mb-2">Signal</div>
                                            <div class="text-gray-300">Perfect Forward Secrecy par d√©faut (Double Ratchet)</div>
                                        </div>
                                        <div class="bg-green-500/20 rounded-lg p-4 border border-green-500/50">
                                            <div class="text-2xl mb-2">‚úÖ</div>
                                            <div class="text-white font-bold mb-2">WhatsApp</div>
                                            <div class="text-gray-300">Perfect Forward Secrecy (protocole Signal)</div>
                                        </div>
                                        <div class="bg-yellow-500/20 rounded-lg p-4 border border-yellow-500/50">
                                            <div class="text-2xl mb-2">‚ö†Ô∏è</div>
                                            <div class="text-white font-bold mb-2">Telegram</div>
                                            <div class="text-gray-300">PFS uniquement en Secret Chats</div>
                                        </div>
                                    </div>
                                </div>

                                <div class="grid grid-cols-2 gap-4">
                                    <button onclick="reset()" class="px-6 py-4 bg-gray-600 hover:bg-gray-700 text-white font-bold rounded-xl transition-all">
                                        üîÑ Recommencer
                                    </button>
                                    <button onclick="initMode(mode === 'sans-pfs' ? 'avec-pfs' : 'sans-pfs')" class="px-6 py-4 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-xl transition-all">
                                        üîÄ Essayer ${mode === 'sans-pfs' ? 'AVEC' : 'SANS'} PFS
                                    </button>
                                </div>
                            </div>
                        ` : ''}

                        <!-- Info Box -->
                        <div class="mt-8 bg-indigo-500/20 border border-indigo-500/50 rounded-xl p-6">
                            <h3 class="text-indigo-300 font-bold text-lg mb-3">üéì Qu'est-ce que Perfect Forward Secrecy ?</h3>
                            <p class="text-white mb-3">
                                Le <strong>Perfect Forward Secrecy (PFS)</strong> est une propri√©t√© cryptographique qui garantit que 
                                la compromission des cl√©s √† long terme ne permet pas de d√©chiffrer les communications pass√©es.
                            </p>
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <p class="font-semibold mb-2 text-yellow-300">M√©canisme:</p>
                                    <p class="text-gray-300">
                                        G√©n√©ration de cl√©s √©ph√©m√®res (temporaires) pour chaque session/message, 
                                        puis destruction imm√©diate apr√®s usage.
                                    </p>
                                </div>
                                <div>
                                    <p class="font-semibold mb-2 text-yellow-300">Impact:</p>
                                    <p class="text-gray-300">
                                        M√™me si un attaquant obtient vos cl√©s aujourd'hui, il ne peut pas 
                                        d√©chiffrer les messages d'hier. Protection de l'historique garantie.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        window.initMode = initMode;
        window.sendMessage = sendMessage;
        window.compromiseKeys = compromiseKeys;
        window.showResult = showResult;
        window.reset = reset;

        // Initial render
        render();
    </script>
</body>
</html>