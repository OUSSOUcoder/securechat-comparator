<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulation: Collecte de M√©tadonn√©es</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="app"></div>

    <script>
        let selectedApp = 'signal';
        let messages = [];
        let newMessage = '';
        let recipient = '';

        const apps = {
            signal: {
                name: 'Signal',
                color: '#2E86DE',
                collects: {
                    content: false, sender: true, recipient: true, timestamp: true,
                    location: false, deviceInfo: false, contacts: false, ipAddress: false, duration: false
                }
            },
            telegram: {
                name: 'Telegram',
                color: '#26A69A',
                collects: {
                    content: true, sender: true, recipient: true, timestamp: true,
                    location: true, deviceInfo: true, contacts: true, ipAddress: true, duration: true
                }
            },
            whatsapp: {
                name: 'WhatsApp',
                color: '#EE6C4D',
                collects: {
                    content: false, sender: true, recipient: true, timestamp: true,
                    location: true, deviceInfo: true, contacts: true, ipAddress: true, duration: true
                }
            }
        };

        const metadataTypes = [
            { key: 'content', label: 'Contenu du Message', icon: 'üëÅÔ∏è', critical: true },
            { key: 'sender', label: 'Identit√© √âmetteur', icon: 'üë§', critical: false },
            { key: 'recipient', label: 'Identit√© Destinataire', icon: 'üë•', critical: false },
            { key: 'timestamp', label: 'Date et Heure', icon: '‚è∞', critical: false },
            { key: 'location', label: 'G√©olocalisation', icon: 'üìç', critical: true },
            { key: 'deviceInfo', label: 'Info Appareil', icon: 'üì±', critical: false },
            { key: 'contacts', label: 'Liste Contacts', icon: 'üìí', critical: true },
            { key: 'ipAddress', label: 'Adresse IP', icon: 'üåê', critical: false },
            { key: 'duration', label: 'Dur√©e Connexion', icon: '‚è±Ô∏è', critical: false }
        ];

        function handleSendMessage() {
            if (!newMessage.trim() || !recipient.trim()) return;

            const msg = {
                id: Date.now(),
                text: newMessage,
                to: recipient,
                timestamp: new Date().toLocaleTimeString('fr-FR'),
                location: 'Ouagadougou, BF',
                device: 'iPhone 13 Pro',
                ip: '192.168.1.' + Math.floor(Math.random() * 255),
                duration: Math.floor(Math.random() * 300) + 60
            };

            messages.push(msg);
            newMessage = '';
            render();
        }

        function getCollectedCount(app) {
            return Object.values(apps[app].collects).filter(v => v).length;
        }

        function render() {
            const app = apps[selectedApp];
            const appEl = document.getElementById('app');

            appEl.innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 p-8">
                    <div class="max-w-7xl mx-auto">
                        <div class="text-center mb-8">
                            <h1 class="text-4xl font-bold text-white mb-2 flex items-center justify-center gap-3">
                                üëÅÔ∏è Simulation: Collecte de M√©tadonn√©es
                            </h1>
                            <p class="text-lg text-gray-300">"Nous tuons des gens sur la base de m√©tadonn√©es" - Michael Hayden, ex-directeur NSA/CIA</p>
                        </div>

                        <div class="grid grid-cols-3 gap-4 mb-8">
                            ${Object.entries(apps).map(([key, appData]) => `
                                <button onclick="selectApp('${key}')" class="p-6 rounded-xl font-bold text-lg transition-all ${
                                    selectedApp === key ? 'shadow-2xl scale-105 text-white' : 'bg-white/10 text-gray-300 hover:bg-white/20'
                                }" style="${selectedApp === key ? `background-color: ${appData.color};` : ''} border-width: 3px; border-color: ${appData.color};">
                                    <div class="text-2xl mb-2">${appData.name}</div>
                                    <div class="text-sm opacity-90">${getCollectedCount(key)}/9 m√©tadonn√©es collect√©es</div>
                                </button>
                            `).join('')}
                        </div>

                        <div class="grid grid-cols-2 gap-8">
                            <!-- Message Interface -->
                            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                                <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                                    üì§ Envoyez un Message
                                </h2>

                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-white font-medium mb-2">Destinataire</label>
                                        <input type="text" id="recipientInput" value="${recipient}" placeholder="Ex: Alice" class="w-full px-4 py-3 rounded-lg bg-white/90 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>

                                    <div>
                                        <label class="block text-white font-medium mb-2">Message</label>
                                        <textarea id="messageInput" placeholder="Tapez votre message..." rows="4" class="w-full px-4 py-3 rounded-lg bg-white/90 text-gray-900 focus:outline-none focus:ring-2 focus:ring-blue-500">${newMessage}</textarea>
                                    </div>

                                    <button id="sendButton" onclick="handleSendMessage()" class="w-full px-6 py-4 rounded-lg font-bold text-white transition-all disabled:opacity-50" style="background-color: ${app.color};">
                                        üì§ Envoyer via ${app.name}
                                    </button>
                                </div>

                                ${messages.length > 0 ? `
                                    <div class="mt-6">
                                        <h3 class="text-white font-bold mb-3">Messages Envoy√©s (${messages.length})</h3>
                                        <div class="space-y-2 max-h-64 overflow-y-auto">
                                            ${messages.map(msg => `
                                                <div class="bg-white/20 rounded-lg p-3 text-white text-sm">
                                                    <div class="font-medium">√Ä: ${msg.to}</div>
                                                    <div class="text-gray-300 truncate">${msg.text}</div>
                                                    <div class="text-xs text-gray-400 mt-1">${msg.timestamp}</div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>

                            <!-- Metadata Collection -->
                            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 border border-white/20">
                                <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                                    üëÅÔ∏è M√©tadonn√©es Collect√©es par ${app.name}
                                </h2>

                                <div class="space-y-3">
                                    ${metadataTypes.map(({ key, label, icon, critical }) => {
                                        const isCollected = app.collects[key];
                                        const lastMsg = messages[messages.length - 1];
                                        return `
                                            <div class="p-4 rounded-lg border-2 transition-all ${
                                                isCollected ? (critical ? 'bg-red-500/30 border-red-500' : 'bg-yellow-500/30 border-yellow-500') : 'bg-green-500/20 border-green-500'
                                            }">
                                                <div class="flex items-start justify-between">
                                                    <div class="flex items-start gap-3">
                                                        <span class="text-xl">${icon}</span>
                                                        <div>
                                                            <div class="font-bold text-white">${label}</div>
                                                            ${isCollected && messages.length > 0 ? `
                                                                <div class="text-sm text-gray-200 mt-1">
                                                                    ${key === 'content' ? `"${lastMsg.text}"` : ''}
                                                                    ${key === 'sender' ? 'Vous' : ''}
                                                                    ${key === 'recipient' ? lastMsg.to : ''}
                                                                    ${key === 'timestamp' ? lastMsg.timestamp : ''}
                                                                    ${key === 'location' ? lastMsg.location : ''}
                                                                    ${key === 'deviceInfo' ? lastMsg.device : ''}
                                                                    ${key === 'ipAddress' ? lastMsg.ip : ''}
                                                                    ${key === 'duration' ? `${lastMsg.duration}s` : ''}
                                                                    ${key === 'contacts' ? `${messages.length} contacts identifi√©s` : ''}
                                                                </div>
                                                            ` : ''}
                                                        </div>
                                                    </div>
                                                    <div class="px-3 py-1 rounded-full text-xs font-bold ${
                                                        isCollected ? 'bg-red-600 text-white' : 'bg-green-600 text-white'
                                                    }">
                                                        ${isCollected ? '‚úó COLLECT√â' : '‚úì PROT√âG√â'}
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>

                                <div class="mt-6 p-4 rounded-xl border-2 ${
                                    selectedApp === 'signal' ? 'bg-green-500/20 border-green-500' : 'bg-red-500/20 border-red-500'
                                }">
                                    <div class="flex items-start gap-3">
                                        <span class="text-2xl">${selectedApp === 'signal' ? 'üõ°Ô∏è' : '‚ö†Ô∏è'}</span>
                                        <div class="text-white">
                                            <div class="font-bold mb-2">
                                                ${selectedApp === 'signal' ? '‚úì Protection Maximale' : '‚ö†Ô∏è Collecte Extensive'}
                                            </div>
                                            <div class="text-sm text-gray-200">
                                                ${selectedApp === 'signal' ? `
                                                    Signal minimise les m√©tadonn√©es. Sealed Sender cache m√™me l'√©metteur au serveur.
                                                    Seuls num√©ro de t√©l√©phone et date de connexion sont stock√©s.
                                                ` : selectedApp === 'telegram' ? `
                                                    Telegram collecte massivement les m√©tadonn√©es. Les messages normaux ne sont PAS chiffr√©s E2EE.
                                                    Tout est accessible au serveur. Secret Chats uniquement prot√®gent le contenu.
                                                ` : `
                                                    WhatsApp prot√®ge le contenu (E2EE) mais collecte √©norm√©ment de m√©tadonn√©es.
                                                    Toutes ces donn√©es sont partag√©es avec Meta/Facebook pour publicit√© cibl√©e.
                                                `}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-8 bg-blue-500/20 border border-blue-500/50 rounded-xl p-6">
                            <h3 class="text-blue-300 font-bold text-lg mb-3">üí° Pourquoi les M√©tadonn√©es sont-elles Critiques?</h3>
                            <div class="grid grid-cols-3 gap-6 text-white text-sm">
                                <div>
                                    <p class="font-semibold mb-2 text-yellow-300">Graphe Social:</p>
                                    <p class="text-gray-300">R√©v√®le qui parle √† qui, quand, combien de fois. Permet de cartographier tout votre r√©seau social.</p>
                                </div>
                                <div>
                                    <p class="font-semibold mb-2 text-yellow-300">Patterns de Vie:</p>
                                    <p class="text-gray-300">Horaires de sommeil, d√©placements, habitudes. Analyse comportementale compl√®te possible.</p>
                                </div>
                                <div>
                                    <p class="font-semibold mb-2 text-yellow-300">Ciblage:</p>
                                    <p class="text-gray-300">Suffisant pour identifier, profiler et cibler des individus. Utilis√© par agences de renseignement.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Event listeners
            const msgInput = document.getElementById('messageInput');
            const recInput = document.getElementById('recipientInput');
            const sendButton = document.getElementById('sendButton');
            
            function updateButtonState() {
                if (sendButton) {
                    sendButton.disabled = !newMessage.trim() || !recipient.trim();
                }
            }
            
            if (msgInput) {
                msgInput.addEventListener('input', (e) => {
                    newMessage = e.target.value;
                    updateButtonState();
                });
            }
            
            if (recInput) {
                recInput.addEventListener('input', (e) => {
                    recipient = e.target.value;
                    updateButtonState();
                });
            }
            
            updateButtonState();
        }

        function selectApp(key) {
            selectedApp = key;
            render();
        }

        window.selectApp = selectApp;
        window.handleSendMessage = handleSendMessage;

        render();
    </script>
</body>
</html>