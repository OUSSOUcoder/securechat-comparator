<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulation: Attaque Man-in-the-Middle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, sans-serif;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes ping {
            75%, 100% {
                transform: scale(2);
                opacity: 0;
            }
        }
        .animate-ping {
            animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        let message = '';
        let encryption = 'none';
        let isAnimating = false;
        let attackerCaptured = '';
        let receiverGot = '';
        let showResult = false;

        function encryptMessage(text) {
            return btoa(text).split('').map((c, i) => 
                String.fromCharCode(c.charCodeAt(0) + (i % 10))
            ).join('');
        }

        function handleSendMessage() {
            if (!message.trim()) return;

            isAnimating = true;
            showResult = false;
            attackerCaptured = '';
            receiverGot = '';
            render();

            setTimeout(() => {
                if (encryption === 'none') {
                    attackerCaptured = message;
                } else {
                    attackerCaptured = encryptMessage(message);
                }
                render();
            }, 1000);

            setTimeout(() => {
                receiverGot = message;
                isAnimating = false;
                showResult = true;
                render();
            }, 2000);
        }

        function getEncryptionColor() {
            return encryption === 'none' ? 'bg-red-500' : 'bg-green-500';
        }

        function render() {
            const app = document.getElementById('app');
            
            app.innerHTML = `
                <div class="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-8">
                    <div class="max-w-6xl mx-auto">
                        <!-- Header -->
                        <div class="text-center mb-8">
                            <h1 class="text-4xl font-bold text-white mb-2">
                                ‚ö†Ô∏è Simulation: Attaque Man-in-the-Middle
                            </h1>
                            <p class="text-lg text-gray-300">
                                Visualisez l'interception des communications avec et sans E2EE
                            </p>
                        </div>

                        <!-- Controls -->
                        <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 mb-8 border border-white/20">
                            <div class="grid grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-white font-semibold mb-2">Votre Message Secret</label>
                                    <input
                                        type="text"
                                        id="messageInput"
                                        value="${message}"
                                        placeholder="Ex: Code d'acc√®s bancaire: 1234"
                                        class="w-full px-4 py-3 rounded-lg bg-white/90 text-gray-900 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>

                                <div>
                                    <label class="block text-white font-semibold mb-2">Type de Protection</label>
                                    <div class="flex gap-4">
                                        <button
                                            onclick="setEncryption('none')"
                                            class="flex-1 px-4 py-3 rounded-lg font-medium transition-all ${
                                                encryption === 'none'
                                                    ? 'bg-red-500 text-white shadow-lg scale-105'
                                                    : 'bg-white/20 text-white hover:bg-white/30'
                                            }"
                                        >
                                            üîì Sans E2EE
                                        </button>
                                        <button
                                            onclick="setEncryption('e2ee')"
                                            class="flex-1 px-4 py-3 rounded-lg font-medium transition-all ${
                                                encryption === 'e2ee'
                                                    ? 'bg-green-500 text-white shadow-lg scale-105'
                                                    : 'bg-white/20 text-white hover:bg-white/30'
                                            }"
                                        >
                                            üîí Avec E2EE
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <button
                                onclick="handleSendMessage()"
                                ${!message.trim() || isAnimating ? 'disabled' : ''}
                                class="w-full mt-6 px-6 py-4 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-500 text-white font-bold rounded-lg transition-all shadow-lg"
                            >
                                üì§ ${isAnimating ? 'Envoi en cours...' : 'Envoyer le Message'}
                            </button>
                        </div>

                        <!-- Network Visualization -->
                        <div class="bg-white/5 backdrop-blur-lg rounded-xl p-8 border border-white/20 mb-8">
                            <div class="grid grid-cols-3 gap-8 items-center">
                                <!-- Sender -->
                                <div class="text-center">
                                    <div class="relative inline-block">
                                        <div class="w-24 h-24 rounded-full ${getEncryptionColor()} bg-opacity-20 flex items-center justify-center border-4 ${
                                            encryption === 'none' ? 'border-red-500' : 'border-green-500'
                                        }">
                                            <span class="text-5xl">üë§</span>
                                        </div>
                                        ${isAnimating ? '<div class="absolute -right-4 top-0"><div class="w-8 h-8 bg-blue-500 rounded-full animate-ping"></div></div>' : ''}
                                    </div>
                                    <h3 class="text-white font-bold mt-4 text-xl">√âmetteur</h3>
                                    <p class="text-gray-300 text-sm mt-2">Vous</p>
                                    ${message ? `
                                        <div class="mt-4 p-3 bg-blue-500/20 rounded-lg border border-blue-500/50">
                                            <p class="text-white font-mono text-sm break-words">${message}</p>
                                        </div>
                                    ` : ''}
                                </div>

                                <!-- Attacker -->
                                <div class="text-center relative">
                                    <div class="absolute left-0 right-0 top-1/2 -translate-y-1/2 h-1 bg-gradient-to-r from-transparent via-red-500 to-transparent"></div>
                                    
                                    <div class="relative inline-block z-10">
                                        <div class="w-32 h-32 rounded-full bg-red-600 bg-opacity-30 flex items-center justify-center border-4 border-red-500 shadow-lg shadow-red-500/50">
                                            <span class="text-6xl">‚ö†Ô∏è</span>
                                        </div>
                                        ${isAnimating ? '<div class="absolute inset-0"><div class="w-full h-full bg-red-500 rounded-full animate-pulse opacity-50"></div></div>' : ''}
                                    </div>
                                    
                                    <h3 class="text-red-400 font-bold mt-4 text-xl">ATTAQUANT</h3>
                                    <p class="text-gray-300 text-sm mt-2">Man-in-the-Middle</p>
                                    
                                    ${attackerCaptured ? `
                                        <div class="mt-4 p-4 rounded-lg border-2 ${
                                            encryption === 'none' 
                                                ? 'bg-red-500/30 border-red-500' 
                                                : 'bg-yellow-500/20 border-yellow-500'
                                        }">
                                            <p class="text-white font-bold text-sm mb-2">
                                                ${encryption === 'none' ? '‚ùå MESSAGE INTERCEPT√â!' : 'üîí Donn√©es Chiffr√©es'}
                                            </p>
                                            <p class="text-white font-mono text-xs break-all">
                                                ${attackerCaptured}
                                            </p>
                                        </div>
                                    ` : ''}
                                </div>

                                <!-- Receiver -->
                                <div class="text-center">
                                    <div class="relative inline-block">
                                        <div class="w-24 h-24 rounded-full ${getEncryptionColor()} bg-opacity-20 flex items-center justify-center border-4 ${
                                            encryption === 'none' ? 'border-red-500' : 'border-green-500'
                                        }">
                                            <span class="text-5xl">üë§</span>
                                        </div>
                                    </div>
                                    <h3 class="text-white font-bold mt-4 text-xl">Destinataire</h3>
                                    <p class="text-gray-300 text-sm mt-2">Contact</p>
                                    ${receiverGot ? `
                                        <div class="mt-4 p-3 bg-green-500/20 rounded-lg border border-green-500/50">
                                            <p class="text-white font-mono text-sm break-words">${receiverGot}</p>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>

                        <!-- Results -->
                        ${showResult ? `
                            <div class="p-6 rounded-xl border-2 ${
                                encryption === 'none'
                                    ? 'bg-red-500/20 border-red-500'
                                    : 'bg-green-500/20 border-green-500'
                            }">
                                <div class="flex items-start gap-4">
                                    ${encryption === 'none' ? `
                                        <div>
                                            <h3 class="text-red-400 font-bold text-xl mb-2">‚ö†Ô∏è ATTAQUE R√âUSSIE - Donn√©es Compromises</h3>
                                            <ul class="text-white space-y-2">
                                                <li>‚úó L'attaquant a intercept√© votre message en clair</li>
                                                <li>‚úó Toutes vos donn√©es sont lisibles</li>
                                                <li>‚úó Identifiants, mots de passe, informations personnelles expos√©s</li>
                                                <li>‚úó <strong>Telegram (chats normaux)</strong> et anciennes apps sont vuln√©rables</li>
                                            </ul>
                                        </div>
                                    ` : `
                                        <div>
                                            <h3 class="text-green-400 font-bold text-xl mb-2">‚úÖ PROTECTION ACTIVE - Donn√©es S√©curis√©es</h3>
                                            <ul class="text-white space-y-2">
                                                <li>‚úì L'attaquant ne voit que des donn√©es chiffr√©es illisibles</li>
                                                <li>‚úì Votre message reste confidentiel</li>
                                                <li>‚úì Perfect Forward Secrecy: m√™me si les cl√©s futures sont compromises</li>
                                                <li>‚úì <strong>Signal</strong> et <strong>WhatsApp</strong> prot√®gent ainsi par d√©faut</li>
                                            </ul>
                                        </div>
                                    `}
                                </div>
                            </div>
                        ` : ''}

                        <!-- Info Box -->
                        <div class="mt-8 bg-blue-500/20 border border-blue-500/50 rounded-xl p-6">
                            <h3 class="text-blue-300 font-bold text-lg mb-3">
                                üîí Comprendre l'Attaque Man-in-the-Middle
                            </h3>
                            <div class="grid grid-cols-2 gap-4 text-white text-sm">
                                <div>
                                    <p class="font-semibold mb-2">Sans E2EE:</p>
                                    <ul class="space-y-1 text-gray-300">
                                        <li>‚Ä¢ Messages transmis en clair</li>
                                        <li>‚Ä¢ Wi-Fi public = danger</li>
                                        <li>‚Ä¢ IMSI catchers efficaces</li>
                                        <li>‚Ä¢ Serveurs compromis = tout expos√©</li>
                                    </ul>
                                </div>
                                <div>
                                    <p class="font-semibold mb-2">Avec E2EE:</p>
                                    <ul class="space-y-1 text-gray-300">
                                        <li>‚Ä¢ Chiffrement bout-en-bout</li>
                                        <li>‚Ä¢ M√™me le serveur ne peut pas lire</li>
                                        <li>‚Ä¢ Protocole Signal = gold standard</li>
                                        <li>‚Ä¢ Protection contre toute interception</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Attach event listeners
            const input = document.getElementById('messageInput');
            if (input) {
                input.addEventListener('input', (e) => {
                    message = e.target.value;
                });
            }
        }

        function setEncryption(type) {
            encryption = type;
            render();
        }

        // Make functions global
        window.handleSendMessage = handleSendMessage;
        window.setEncryption = setEncryption;

        // Initial render
        render();
    </script>
</body>
</html>